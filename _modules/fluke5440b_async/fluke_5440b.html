
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>fluke5440b_async.fluke_5440b &#8212; fluke5440b_async v1.0.1 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/nature.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/custom.css" />
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/sphinx_highlight.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">fluke5440b_async v1.0.1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" accesskey="U">Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">fluke5440b_async.fluke_5440b</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for fluke5440b_async.fluke_5440b</h1><div class="highlight"><pre>
<span></span><span class="c1"># ##### BEGIN GPL LICENSE BLOCK #####</span>
<span class="c1">#</span>
<span class="c1"># Copyright (C) 2023 Patrick Baus</span>
<span class="c1"># This file is free software: you can redistribute it and/or modify</span>
<span class="c1"># it under the terms of the GNU General Public License as published by</span>
<span class="c1"># the Free Software Foundation, either version 3 of the License, or</span>
<span class="c1"># (at your option) any later version.</span>
<span class="c1">#</span>
<span class="c1"># This file is distributed in the hope that it will be useful,</span>
<span class="c1"># but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="c1"># MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<span class="c1"># GNU General Public License for more details.</span>
<span class="c1">#</span>
<span class="c1"># You should have received a copy of the GNU General Public License</span>
<span class="c1"># along with this file.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
<span class="c1">#</span>
<span class="c1"># ##### END GPL LICENSE BLOCK #####</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">This is an asyncIO driver for the Fluke 5440B voltage calibrator to abstract away the GPIB interface.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">annotations</span>

<span class="kn">import</span> <span class="nn">asyncio</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span>
<span class="kn">from</span> <span class="nn">decimal</span> <span class="kn">import</span> <span class="n">Decimal</span>
<span class="kn">from</span> <span class="nn">types</span> <span class="kn">import</span> <span class="n">TracebackType</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">TYPE_CHECKING</span><span class="p">,</span> <span class="n">Type</span><span class="p">,</span> <span class="n">cast</span>

<span class="kn">from</span> <span class="nn">fluke5440b_async.enums</span> <span class="kn">import</span> <span class="n">DeviceState</span><span class="p">,</span> <span class="n">ErrorCode</span><span class="p">,</span> <span class="n">ModeType</span><span class="p">,</span> <span class="n">SelfTestErrorCode</span><span class="p">,</span> <span class="n">SeparatorType</span><span class="p">,</span> <span class="n">TerminatorType</span>
<span class="kn">from</span> <span class="nn">fluke5440b_async.errors</span> <span class="kn">import</span> <span class="n">DeviceError</span><span class="p">,</span> <span class="n">SelftestError</span>
<span class="kn">from</span> <span class="nn">fluke5440b_async.flags</span> <span class="kn">import</span> <span class="n">SerialPollFlags</span><span class="p">,</span> <span class="n">SrqMask</span><span class="p">,</span> <span class="n">StatusFlags</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Self</span>  <span class="c1"># type: ignore # Python 3.11</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">typing_extensions</span> <span class="kn">import</span> <span class="n">Self</span>

<span class="k">if</span> <span class="n">TYPE_CHECKING</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">async_gpib</span> <span class="kn">import</span> <span class="n">AsyncGpib</span>
    <span class="kn">from</span> <span class="nn">prologix_gpib_async</span> <span class="kn">import</span> <span class="n">AsyncPrologixGpibController</span>

<span class="n">BAUD_RATES_AVAILABLE</span> <span class="o">=</span> <span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">75</span><span class="p">,</span> <span class="mi">110</span><span class="p">,</span> <span class="mf">134.5</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">600</span><span class="p">,</span> <span class="mi">1200</span><span class="p">,</span> <span class="mi">1800</span><span class="p">,</span> <span class="mi">2400</span><span class="p">,</span> <span class="mi">4800</span><span class="p">,</span> <span class="mi">9600</span><span class="p">)</span>


<div class="viewcode-block" id="CalibrationConstants"><a class="viewcode-back" href="../../modules.html#fluke5440b_async.CalibrationConstants">[docs]</a><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">CalibrationConstants</span><span class="p">:</span>  <span class="c1"># pylint: disable=too-many-instance-attributes</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The calibration constants of the Fluke 5440B.&quot;&quot;&quot;</span>

    <span class="c1"># capital V due to SI pylint: disable=invalid-name</span>
    <span class="n">gain_02V</span><span class="p">:</span> <span class="n">Decimal</span>
    <span class="n">gain_2V</span><span class="p">:</span> <span class="n">Decimal</span>
    <span class="n">gain_10V</span><span class="p">:</span> <span class="n">Decimal</span>
    <span class="n">gain_20V</span><span class="p">:</span> <span class="n">Decimal</span>
    <span class="n">gain_250V</span><span class="p">:</span> <span class="n">Decimal</span>
    <span class="n">gain_1000V</span><span class="p">:</span> <span class="n">Decimal</span>
    <span class="n">offset_10V_pos</span><span class="p">:</span> <span class="n">Decimal</span>
    <span class="n">offset_20V_pos</span><span class="p">:</span> <span class="n">Decimal</span>
    <span class="n">offset_250V_pos</span><span class="p">:</span> <span class="n">Decimal</span>
    <span class="n">offset_1000V_pos</span><span class="p">:</span> <span class="n">Decimal</span>
    <span class="n">offset_10V_neg</span><span class="p">:</span> <span class="n">Decimal</span>
    <span class="n">offset_20V_neg</span><span class="p">:</span> <span class="n">Decimal</span>
    <span class="n">offset_250V_neg</span><span class="p">:</span> <span class="n">Decimal</span>
    <span class="n">offset_1000V_neg</span><span class="p">:</span> <span class="n">Decimal</span>
    <span class="n">gain_shift_10V</span><span class="p">:</span> <span class="n">Decimal</span>
    <span class="n">gain_shift_20V</span><span class="p">:</span> <span class="n">Decimal</span>
    <span class="n">gain_shift_250V</span><span class="p">:</span> <span class="n">Decimal</span>
    <span class="n">gain_shift_1000V</span><span class="p">:</span> <span class="n">Decimal</span>
    <span class="n">resolution_ratio</span><span class="p">:</span> <span class="n">Decimal</span>
    <span class="n">adc_gain</span><span class="p">:</span> <span class="n">Decimal</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Pretty-print the calibration constants.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Gain 0.2 V       : </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">gain_02V</span><span class="o">*</span><span class="mi">10</span><span class="o">**</span><span class="mi">3</span><span class="si">:</span><span class="s2">.8f</span><span class="si">}</span><span class="s2"> mV</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;Gain 2 V         : </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">gain_2V</span><span class="o">*</span><span class="mi">10</span><span class="o">**</span><span class="mi">3</span><span class="si">:</span><span class="s2">.8f</span><span class="si">}</span><span class="s2"> mV</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;Gain 10 V        : </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">gain_10V</span><span class="o">*</span><span class="mi">10</span><span class="o">**</span><span class="mi">3</span><span class="si">:</span><span class="s2">.8f</span><span class="si">}</span><span class="s2"> mV</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;Gain 20 V        : </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">gain_20V</span><span class="o">*</span><span class="mi">10</span><span class="o">**</span><span class="mi">3</span><span class="si">:</span><span class="s2">.8f</span><span class="si">}</span><span class="s2"> mV</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;Gain 250 V       : </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">gain_250V</span><span class="o">*</span><span class="mi">10</span><span class="o">**</span><span class="mi">3</span><span class="si">:</span><span class="s2">.8f</span><span class="si">}</span><span class="s2"> mV</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;Gain 1000 V      : </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">gain_1000V</span><span class="o">*</span><span class="mi">10</span><span class="o">**</span><span class="mi">3</span><span class="si">:</span><span class="s2">.8f</span><span class="si">}</span><span class="s2"> mV</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;Offset +10 V     : </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">offset_10V_pos</span><span class="o">*</span><span class="mi">10</span><span class="o">**</span><span class="mi">3</span><span class="si">:</span><span class="s2">.8f</span><span class="si">}</span><span class="s2"> mV</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;Offset +20 V     : </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">offset_20V_pos</span><span class="o">*</span><span class="mi">10</span><span class="o">**</span><span class="mi">3</span><span class="si">:</span><span class="s2">.8f</span><span class="si">}</span><span class="s2"> mV</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;Offset +250 V    : </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">offset_250V_pos</span><span class="o">*</span><span class="mi">10</span><span class="o">**</span><span class="mi">3</span><span class="si">:</span><span class="s2">.8f</span><span class="si">}</span><span class="s2"> mV</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;Offset +1000 V   : </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">offset_1000V_pos</span><span class="o">*</span><span class="mi">10</span><span class="o">**</span><span class="mi">3</span><span class="si">:</span><span class="s2">.8f</span><span class="si">}</span><span class="s2"> mV</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;Offset -10 V     : </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">offset_10V_neg</span><span class="o">*</span><span class="mi">10</span><span class="o">**</span><span class="mi">3</span><span class="si">:</span><span class="s2">.8f</span><span class="si">}</span><span class="s2"> mV</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;Offset -20 V     : </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">offset_20V_neg</span><span class="o">*</span><span class="mi">10</span><span class="o">**</span><span class="mi">3</span><span class="si">:</span><span class="s2">.8f</span><span class="si">}</span><span class="s2"> mV</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;Offset -250 V    : </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">offset_250V_neg</span><span class="o">*</span><span class="mi">10</span><span class="o">**</span><span class="mi">3</span><span class="si">:</span><span class="s2">.8f</span><span class="si">}</span><span class="s2"> mV</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;Offset -1000 V   : </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">offset_1000V_neg</span><span class="o">*</span><span class="mi">10</span><span class="o">**</span><span class="mi">3</span><span class="si">:</span><span class="s2">.8f</span><span class="si">}</span><span class="s2"> mV</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;Gain shift 10 V  : </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">gain_shift_10V</span><span class="si">}</span><span class="s2"> µV/V</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;Gain shift 20 V  : </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">gain_shift_20V</span><span class="si">}</span><span class="s2"> µV/V</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;Gain shift 250 V : </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">gain_shift_250V</span><span class="si">}</span><span class="s2"> µV/V</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;Gain shift 1000 V: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">gain_shift_1000V</span><span class="si">}</span><span class="s2"> µV/V</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;Resolution ratio : </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">resolution_ratio</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;ADC gain         : </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">adc_gain</span><span class="o">*</span><span class="mi">10</span><span class="o">**</span><span class="mi">3</span><span class="si">:</span><span class="s2">.8f</span><span class="si">}</span><span class="s2"> mV&quot;</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="Fluke_5440B"><a class="viewcode-back" href="../../modules.html#fluke5440b_async.Fluke_5440B">[docs]</a><span class="k">class</span> <span class="nc">Fluke_5440B</span><span class="p">:</span>  <span class="c1"># noqa pylint: disable=too-many-public-methods,invalid-name,too-many-lines</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The driver for the Fluke 5440B voltage calibrator. It supports both linux-gpib and the Prologix GPIB adapters.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">connection</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AsyncGpib</span> <span class="o">|</span> <span class="n">AsyncPrologixGpibController</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The GPIB connection.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__conn</span>

<div class="viewcode-block" id="Fluke_5440B.__init__"><a class="viewcode-back" href="../../modules.html#fluke5440b_async.Fluke_5440B.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">connection</span><span class="p">:</span> <span class="n">AsyncGpib</span> <span class="o">|</span> <span class="n">AsyncPrologixGpibController</span><span class="p">,</span> <span class="n">log_level</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">WARNING</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create Fluke 5440B device with the GPIB connection given.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        connection: AsyncGpib or AsyncPrologixGpibController</span>
<span class="sd">            The GPIB connection.</span>
<span class="sd">        log_level: int, default=logging.WARNING</span>
<span class="sd">            The level of logging output. By default, only warnings or higher are output.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__conn</span> <span class="o">=</span> <span class="n">connection</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__lock</span><span class="p">:</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">Lock</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">log_level</span><span class="p">)</span>  <span class="c1"># Only log really important messages by default</span></div>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Fluke 5440B at </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">connection</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">async</span> <span class="k">def</span> <span class="fm">__aenter__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Self</span><span class="p">:</span>
        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">async</span> <span class="k">def</span> <span class="fm">__aexit__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">exc_type</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="ne">BaseException</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span> <span class="n">exc</span><span class="p">:</span> <span class="ne">BaseException</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span> <span class="n">traceback</span><span class="p">:</span> <span class="n">TracebackType</span> <span class="o">|</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>

<div class="viewcode-block" id="Fluke_5440B.get_id"><a class="viewcode-back" href="../../modules.html#fluke5440b_async.Fluke_5440B.get_id">[docs]</a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">get_id</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the instrument name and the software version string. To emulate the `*IDN?` SCPI command, the result</span>
<span class="sd">        is a tuple containing the Manufacturer, Device, Serial (0) and FW version.</span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        tuple of str</span>
<span class="sd">            A tuple containing the manufacturer id, device id, a zero, and the software version.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">version</span> <span class="o">=</span> <span class="p">(</span><span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_software_version</span><span class="p">())</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">return</span> <span class="s2">&quot;Fluke&quot;</span><span class="p">,</span> <span class="s2">&quot;5440B&quot;</span><span class="p">,</span> <span class="s2">&quot;0&quot;</span><span class="p">,</span> <span class="n">version</span></div>

<div class="viewcode-block" id="Fluke_5440B.set_log_level"><a class="viewcode-back" href="../../modules.html#fluke5440b_async.Fluke_5440B.set_log_level">[docs]</a>    <span class="k">def</span> <span class="nf">set_log_level</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">loglevel</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">WARNING</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the log level of the library. By default, the level is set to warning.</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        loglevel: int, default=logging.WARNING</span>
<span class="sd">            The log level of the library</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">loglevel</span><span class="p">)</span></div>

<div class="viewcode-block" id="Fluke_5440B.connect"><a class="viewcode-back" href="../../modules.html#fluke5440b_async.Fluke_5440B.connect">[docs]</a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Connect the GPIB connection and configure the GPIB device for the DMM. This function must be called from the</span>
<span class="sd">        AsyncIO loop and takes care of connecting the GPIB adapter.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__lock</span> <span class="o">=</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">Lock</span><span class="p">()</span>

        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">__conn</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__conn</span><span class="p">,</span> <span class="s2">&quot;set_eot&quot;</span><span class="p">):</span>
            <span class="c1"># Used by the Prologix adapters</span>
            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">__conn</span><span class="o">.</span><span class="n">set_eot</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

        <span class="k">async</span> <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">__lock</span><span class="p">:</span>
            <span class="n">status</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">serial_poll</span><span class="p">()</span>  <span class="c1"># clears the SRQ bit</span>
            <span class="k">while</span> <span class="n">status</span> <span class="o">&amp;</span> <span class="n">SerialPollFlags</span><span class="o">.</span><span class="n">MSG_RDY</span><span class="p">:</span>  <span class="c1"># clear message buffer</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Calibrator message at boot: </span><span class="si">%s</span><span class="s2">.&quot;</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>
                <span class="n">status</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">serial_poll</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">status</span> <span class="o">&amp;</span> <span class="n">SerialPollFlags</span><span class="o">.</span><span class="n">ERROR_CONDITION</span><span class="p">:</span>
                <span class="n">err</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_error</span><span class="p">()</span>  <span class="c1"># clear error flags not produced by us</span>
                <span class="n">error</span><span class="p">:</span> <span class="n">ErrorCode</span> <span class="o">|</span> <span class="n">SelfTestErrorCode</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">error</span> <span class="o">=</span> <span class="n">ErrorCode</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                    <span class="n">error</span> <span class="o">=</span> <span class="n">SelfTestErrorCode</span><span class="p">(</span><span class="n">err</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Calibrator errors at boot: </span><span class="si">%s</span><span class="s2">.&quot;</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
            <span class="n">state</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_state</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Calibrator state at boot: </span><span class="si">%s</span><span class="s2">.&quot;</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">state</span> <span class="o">!=</span> <span class="n">DeviceState</span><span class="o">.</span><span class="n">IDLE</span><span class="p">:</span>
                <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_srq_mask</span><span class="p">(</span><span class="n">SrqMask</span><span class="o">.</span><span class="n">DOING_STATE_CHANGE</span><span class="p">)</span>
                <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">__wait_for_idle</span><span class="p">()</span>

            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">__set_terminator</span><span class="p">(</span><span class="n">TerminatorType</span><span class="o">.</span><span class="n">LF_EOI</span><span class="p">)</span>  <span class="c1"># terminate lines with \n</span>
            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">__set_separator</span><span class="p">(</span><span class="n">SeparatorType</span><span class="o">.</span><span class="n">COMMA</span><span class="p">)</span>  <span class="c1"># use a comma as the separator</span>
            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_srq_mask</span><span class="p">(</span><span class="n">SrqMask</span><span class="o">.</span><span class="n">NONE</span><span class="p">)</span>  <span class="c1"># Disable interrupts</span></div>

<div class="viewcode-block" id="Fluke_5440B.disconnect"><a class="viewcode-back" href="../../modules.html#fluke5440b_async.Fluke_5440B.disconnect">[docs]</a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">disconnect</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Disconnect from the instrument and clean up. This call will also automatically remove the local lockout if set.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Return access to the device</span>
            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">local</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">ConnectionError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">__conn</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span></div>

<div class="viewcode-block" id="Fluke_5440B.write"><a class="viewcode-back" href="../../modules.html#fluke5440b_async.Fluke_5440B.write">[docs]</a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cmd</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">test_error</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Write a string or bytestring to the instrument.</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        cmd: str or bytes</span>
<span class="sd">            The command written to the device</span>
<span class="sd">        test_error: bool, default=False</span>
<span class="sd">            Check for errors by serial polling after sending the command.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        DeviceError</span>
<span class="sd">            If test_error is set to True and there was an error processing the command.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">))</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">cmd</span> <span class="o">=</span> <span class="n">cmd</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s2">&quot;ascii&quot;</span><span class="p">)</span>  <span class="c1"># type: ignore[union-attr]</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="k">pass</span>  <span class="c1"># cmd is already a bytestring</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">)</span>
        <span class="c1"># The calibrator can only buffer 127 byte</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">127</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Command size must be 127 byte or less.&quot;</span><span class="p">)</span>

        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">__conn</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">test_error</span><span class="p">:</span>
            <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)</span>  <span class="c1"># The instrument is slow in parsing commands</span>
            <span class="n">spoll</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">serial_poll</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">spoll</span> <span class="o">&amp;</span> <span class="n">SerialPollFlags</span><span class="o">.</span><span class="n">ERROR_CONDITION</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Received error while writing command </span><span class="si">%s</span><span class="s2">. Serial poll register: </span><span class="si">%s</span><span class="s2">.&quot;</span><span class="p">,</span> <span class="n">cmd</span><span class="p">,</span> <span class="n">spoll</span><span class="p">)</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">if</span> <span class="n">spoll</span> <span class="o">&amp;</span> <span class="n">SerialPollFlags</span><span class="o">.</span><span class="n">MSG_RDY</span><span class="p">:</span>
                    <span class="c1"># The command did return some msg, so we need to read that first (and drop it)</span>
                    <span class="n">msg</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>

                <span class="n">err</span> <span class="o">=</span> <span class="n">ErrorCode</span><span class="p">(</span><span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_error</span><span class="p">())</span>
                <span class="k">if</span> <span class="n">msg</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">DeviceError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Device error on command: </span><span class="si">{</span><span class="n">cmd</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">, code: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>
                <span class="k">raise</span> <span class="n">DeviceError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Device error on command: </span><span class="si">{</span><span class="n">cmd</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">, code: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">, Message returned: </span><span class="si">{</span><span class="n">msg</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">err</span>
                <span class="p">)</span></div>

<div class="viewcode-block" id="Fluke_5440B.read"><a class="viewcode-back" href="../../modules.html#fluke5440b_async.Fluke_5440B.read">[docs]</a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">read</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Read from the device.</span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        str or list of str:</span>
<span class="sd">            Returns either a simple string, or if multiple results are returned, a list of strings.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="p">(</span><span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">__conn</span><span class="o">.</span><span class="n">read</span><span class="p">())</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>  <span class="c1"># strip \n and split at the separator</span>
        <span class="k">return</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="n">result</span></div>

<div class="viewcode-block" id="Fluke_5440B.query"><a class="viewcode-back" href="../../modules.html#fluke5440b_async.Fluke_5440B.query">[docs]</a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">query</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cmd</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">test_error</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Write a string or bytestring to the instrument, then immediately read back the result. This is a combined call</span>
<span class="sd">        to :func:`write` and :func:`read`.</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        cmd: str or bytes</span>
<span class="sd">            The command written to the device</span>
<span class="sd">        test_error: bool, default=False</span>
<span class="sd">            Check for errors by serial polling after sending the command.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        str or list of str:</span>
<span class="sd">            Returns either a simple string, or if multiple results are returned, a list of strings.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        DeviceError</span>
<span class="sd">            If test_error is set to True and there was an error processing the command.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">test_error</span><span class="p">)</span>
        <span class="k">return</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">read</span><span class="p">()</span></div>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">__wait_for_state_change</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">while</span> <span class="p">(</span><span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">serial_poll</span><span class="p">())</span> <span class="o">&amp;</span> <span class="n">SerialPollFlags</span><span class="o">.</span><span class="n">DOING_STATE_CHANGE</span><span class="p">:</span>
            <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>

<div class="viewcode-block" id="Fluke_5440B.reset"><a class="viewcode-back" href="../../modules.html#fluke5440b_async.Fluke_5440B.reset">[docs]</a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Place the instrument in standby, enable voltage mode, set the output voltage to 0.0, disable the divider output,</span>
<span class="sd">        the external guard mode and external sense mode.</span>
<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        DeviceError</span>
<span class="sd">            Raised if there was an error processing the command.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">__lock</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="k">async</span> <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">__lock</span><span class="p">:</span>
            <span class="c1"># We do not send &quot;RESET&quot;, because a DCL will do the same and additionally circumvents the input buffer</span>
            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">__conn</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
            <span class="c1"># We cannot use interrupts, because the device is resetting all settings and will not accept commands</span>
            <span class="c1"># until it has reset. So we will poll the status register first, and when this is done, we will poll</span>
            <span class="c1"># the device itself until it is ready</span>
            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">__wait_for_state_change</span><span class="p">()</span>
            <span class="k">while</span> <span class="p">(</span><span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_state</span><span class="p">())</span> <span class="o">!=</span> <span class="n">DeviceState</span><span class="o">.</span><span class="n">IDLE</span><span class="p">:</span>
                <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>

            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">__set_terminator</span><span class="p">(</span><span class="n">TerminatorType</span><span class="o">.</span><span class="n">LF_EOI</span><span class="p">)</span>  <span class="c1"># terminate lines with \n</span>
            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">__set_separator</span><span class="p">(</span><span class="n">SeparatorType</span><span class="o">.</span><span class="n">COMMA</span><span class="p">)</span>  <span class="c1"># use a comma as the separator</span>
            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_srq_mask</span><span class="p">(</span><span class="n">SrqMask</span><span class="o">.</span><span class="n">NONE</span><span class="p">)</span>  <span class="c1"># Disable interrupts</span></div>

<div class="viewcode-block" id="Fluke_5440B.local"><a class="viewcode-back" href="../../modules.html#fluke5440b_async.Fluke_5440B.local">[docs]</a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">local</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Enable the front panel buttons, if the instrument is in local lock out.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">__conn</span><span class="o">.</span><span class="n">ibloc</span><span class="p">()</span></div>

<div class="viewcode-block" id="Fluke_5440B.get_terminator"><a class="viewcode-back" href="../../modules.html#fluke5440b_async.Fluke_5440B.get_terminator">[docs]</a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">get_terminator</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TerminatorType</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the line terminator sent by the instrument.</span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        TerminatorType</span>
<span class="sd">            The line terminator used by the device.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">__lock</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="k">async</span> <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">__lock</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;GTRM&quot;</span><span class="p">,</span> <span class="n">test_error</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
                <span class="n">term</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid reply received. Expected an integer, but received: </span><span class="si">{</span><span class="n">result</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="kn">from</span> <span class="kc">None</span>
            <span class="k">return</span> <span class="n">TerminatorType</span><span class="p">(</span><span class="n">term</span><span class="p">)</span></div>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">__set_terminator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">TerminatorType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the line terminator used by the instrument. The choice of line terminators are EOI, &lt;CR&gt;&lt;LF&gt;&lt;EOI&gt;,</span>
<span class="sd">        &lt;LF&gt;&lt;EOI&gt;, &lt;CR&gt;&lt;LF&gt; and &lt;LF&gt; only. Engage the lock, before calling.</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        value: TerminatorType</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        DeviceError</span>
<span class="sd">            Raised if there was an error processing the command.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">TerminatorType</span><span class="p">)</span>
        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;STRM </span><span class="si">{</span><span class="n">value</span><span class="o">.</span><span class="n">value</span><span class="si">:</span><span class="s2">d</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">test_error</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">__wait_for_state_change</span><span class="p">()</span>

<div class="viewcode-block" id="Fluke_5440B.get_separator"><a class="viewcode-back" href="../../modules.html#fluke5440b_async.Fluke_5440B.get_separator">[docs]</a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">get_separator</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SeparatorType</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the separator used by the instrument to separate multiple queries.</span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        SeparatorType</span>
<span class="sd">            The separator used by the device.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        DeviceError</span>
<span class="sd">            Raised if there was an error processing the command.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;GSEP&quot;</span><span class="p">,</span> <span class="n">test_error</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
            <span class="n">sep</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid reply received. Expected an integer, but received: </span><span class="si">{</span><span class="n">result</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="kn">from</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">SeparatorType</span><span class="p">(</span><span class="n">sep</span><span class="p">)</span></div>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">__set_separator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">SeparatorType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the query separator used by the instrument. The choice of separators are &quot;,&quot; (colon) and &quot;;&quot; (semicolon).</span>
<span class="sd">        Engage the lock, before calling.</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        value: SeparatorType</span>
<span class="sd">            The separator used by the device.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        DeviceError</span>
<span class="sd">            Raised if there was an error processing the command.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">SeparatorType</span><span class="p">)</span>
        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SSEP </span><span class="si">{</span><span class="n">value</span><span class="o">.</span><span class="n">value</span><span class="si">:</span><span class="s2">d</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">test_error</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">__wait_for_state_change</span><span class="p">()</span>

<div class="viewcode-block" id="Fluke_5440B.set_mode"><a class="viewcode-back" href="../../modules.html#fluke5440b_async.Fluke_5440B.set_mode">[docs]</a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">set_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">ModeType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Enabled either voltage or current boost mode using an external Fluke 5205A power amplifier or a Fluke 5220A</span>
<span class="sd">        transconductance amplifier.</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        value: ModeType</span>
<span class="sd">            Either normal mode, current or voltage boost.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        DeviceError</span>
<span class="sd">            Raised if there was an error processing the command.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">ModeType</span><span class="p">)</span>
        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">value</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">test_error</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="Fluke_5440B.set_output_enabled"><a class="viewcode-back" href="../../modules.html#fluke5440b_async.Fluke_5440B.set_output_enabled">[docs]</a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">set_output_enabled</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">enabled</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the output to either STANDBY or OPR.</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        enabled: bool</span>
<span class="sd">            Set to OPR if true</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        DeviceError</span>
<span class="sd">            Raised if there was an error processing the command.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;OPER&quot;</span> <span class="k">if</span> <span class="n">enabled</span> <span class="k">else</span> <span class="s2">&quot;STBY&quot;</span><span class="p">,</span> <span class="n">test_error</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="Fluke_5440B.get_output"><a class="viewcode-back" href="../../modules.html#fluke5440b_async.Fluke_5440B.get_output">[docs]</a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">get_output</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Decimal</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the output voltage currently set.</span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        Decimal</span>
<span class="sd">            The output voltage set.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        DeviceError</span>
<span class="sd">            Raised if there was an error processing the command.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;GOUT&quot;</span><span class="p">,</span> <span class="n">test_error</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Decimal</span><span class="p">(</span><span class="n">result</span><span class="p">)</span></div>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">__limit_numeric</span><span class="p">(</span><span class="n">value</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">float</span> <span class="o">|</span> <span class="n">Decimal</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        According to page 4-5 of the operator manual, the value needs to meet the following criteria:</span>
<span class="sd">         - Maximum of 8 significant digits</span>
<span class="sd">         - Exponent must have less than two digits</span>
<span class="sd">         - Integers must be less than 256</span>
<span class="sd">         - 10e-12 &lt; abs(value) &lt; 10e8</span>
<span class="sd">         Limit to to 10*-8 resolution (10 nV is the minimum)</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        value: int or float or Decimal</span>
<span class="sd">            The input to format</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        str</span>
<span class="sd">            A formatted string of the number.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">value</span><span class="si">:</span><span class="s2">.8f</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># type: ignore[operator]</span>
            <span class="c1"># There are significant digits before the decimal point, so we need to limit the length of the string</span>
            <span class="c1"># to 9 characters (decimal point + 8 significant digits)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">result</span><span class="si">:</span><span class="s2">.9s</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="n">result</span>

<div class="viewcode-block" id="Fluke_5440B.set_output"><a class="viewcode-back" href="../../modules.html#fluke5440b_async.Fluke_5440B.set_output">[docs]</a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">set_output</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">float</span> <span class="o">|</span> <span class="n">Decimal</span><span class="p">,</span> <span class="n">test_error</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the output of the calibrator. If an output greater than ±22 V is set, the calibrator will automatically go</span>
<span class="sd">        to STBY for safety reasons. Call `set_output_enabled(True)` to re-enable the output.</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        value: int or float or Decimal</span>
<span class="sd">            The value to be set</span>
<span class="sd">        test_error: bool, Default=True</span>
<span class="sd">            Raise an exception if there was an error</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        DeviceError</span>
<span class="sd">            Raised if there was an error processing the command and test_error was set to True.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="o">-</span><span class="mi">1500</span> <span class="o">&gt;</span> <span class="n">value</span> <span class="o">&gt;</span> <span class="mi">1500</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Value out of range&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SOUT </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">__limit_numeric</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">test_error</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">DeviceError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">code</span> <span class="o">==</span> <span class="n">ErrorCode</span><span class="o">.</span><span class="n">OUTPUT_OUTSIDE_LIMITS</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Value out of range&quot;</span><span class="p">)</span> <span class="kn">from</span> <span class="kc">None</span>
            <span class="k">raise</span></div>

<div class="viewcode-block" id="Fluke_5440B.set_internal_sense"><a class="viewcode-back" href="../../modules.html#fluke5440b_async.Fluke_5440B.set_internal_sense">[docs]</a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">set_internal_sense</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">enabled</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        If the load resistance is greater than 1 MΩ, 2-wire calibration can be used. Otherwise, the cable resistance</span>
<span class="sd">        will reduce the accuracy. Use internal sense for 2-wire calibrations. See page 2-13 of the operator manual for</span>
<span class="sd">        details.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        enabled: bool</span>
<span class="sd">            Set to True for 2-wire sense.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        DeviceError</span>
<span class="sd">            Raised if there was an error processing the command.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;ISNS&quot;</span> <span class="k">if</span> <span class="n">enabled</span> <span class="k">else</span> <span class="s2">&quot;ESNS&quot;</span><span class="p">,</span> <span class="n">test_error</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">DeviceError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">code</span> <span class="o">==</span> <span class="n">ErrorCode</span><span class="o">.</span><span class="n">INVALID_SENSE_MODE</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Sense mode not allowed.&quot;</span><span class="p">)</span> <span class="kn">from</span> <span class="kc">None</span>
            <span class="k">raise</span></div>

<div class="viewcode-block" id="Fluke_5440B.set_internal_guard"><a class="viewcode-back" href="../../modules.html#fluke5440b_async.Fluke_5440B.set_internal_guard">[docs]</a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">set_internal_guard</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">enabled</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        If set, the guard is internally connected to the output LO terminal. Use this, if the device being calibrated</span>
<span class="sd">        has floating inputs. If calibrating devices with grounded inputs, connect the guard terminal to the input LO of</span>
<span class="sd">        the device and disable the internal guard. See page 2-14 of the operator manual for details.</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        enabled: bool</span>
<span class="sd">            Set to True for floating devices.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        DeviceError</span>
<span class="sd">            Raised if there was an error processing the command.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;IGRD&quot;</span> <span class="k">if</span> <span class="n">enabled</span> <span class="k">else</span> <span class="s2">&quot;EGRD&quot;</span><span class="p">,</span> <span class="n">test_error</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">DeviceError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">code</span> <span class="o">==</span> <span class="n">ErrorCode</span><span class="o">.</span><span class="n">INVALID_GUARD_MODE</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Guard mode not allowed.&quot;</span><span class="p">)</span> <span class="kn">from</span> <span class="kc">None</span>
            <span class="k">raise</span></div>

<div class="viewcode-block" id="Fluke_5440B.set_divider"><a class="viewcode-back" href="../../modules.html#fluke5440b_async.Fluke_5440B.set_divider">[docs]</a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">set_divider</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">enabled</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Enable the internal 1:10 and 1:100 divider to reduce the output noise and increase the resolution of voltages</span>
<span class="sd">        in the range -2.2 V to 2.2 V. Do not enable the external sense connection via :func:`set_internal_sense(False)`,</span>
<span class="sd">        as this will decrease the accuracy. The divider has an output impedance of 450 Ω. The load should ideally be</span>
<span class="sd">        greater than 1 GΩ to keep the loading error below 1 ppm. See page 3-10 of the operator manual for details.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        enabled: bool</span>
<span class="sd">            Set to True to enable the divider.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        DeviceError</span>
<span class="sd">            Raised if there was an error processing the command.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;DIVY&quot;</span> <span class="k">if</span> <span class="n">enabled</span> <span class="k">else</span> <span class="s2">&quot;DIVN&quot;</span><span class="p">,</span> <span class="n">test_error</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="Fluke_5440B.get_voltage_limit"><a class="viewcode-back" href="../../modules.html#fluke5440b_async.Fluke_5440B.get_voltage_limit">[docs]</a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">get_voltage_limit</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">Decimal</span><span class="p">,</span> <span class="n">Decimal</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the voltage limit set on the instrument. It will raise an error, when in current boost mode.</span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        tuple of Decimal</span>
<span class="sd">            The positive and negative limit</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        DeviceError</span>
<span class="sd">            Raised if there was an error processing the command.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># TODO: Needs testing for error when in current boost mode</span>
        <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;GVLM&quot;</span><span class="p">,</span> <span class="n">test_error</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Decimal</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">Decimal</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span></div>

<div class="viewcode-block" id="Fluke_5440B.set_voltage_limit"><a class="viewcode-back" href="../../modules.html#fluke5440b_async.Fluke_5440B.set_voltage_limit">[docs]</a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">set_voltage_limit</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">float</span> <span class="o">|</span> <span class="n">Decimal</span><span class="p">,</span> <span class="n">value2</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">float</span> <span class="o">|</span> <span class="n">Decimal</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the positive and negative voltage limit.</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        value: int or float or Decimal</span>
<span class="sd">            Either a positive or negative number to set the positive or negative limit.</span>
<span class="sd">        value2: int or float or Decimal, optional</span>
<span class="sd">            Either a positive or negative number to set the positive or negative limit. If omitted, only one limit will</span>
<span class="sd">            be set.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        DeviceError</span>
<span class="sd">            Raised if there was an error processing the command.</span>
<span class="sd">        ValueError</span>
<span class="sd">            Raised if the limits are out of bounds.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">Decimal</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">if</span> <span class="o">-</span><span class="mi">1500</span> <span class="o">&gt;</span> <span class="n">value</span> <span class="o">&gt;</span> <span class="mi">1500</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Value out of range.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">value2</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">value2</span> <span class="o">=</span> <span class="n">Decimal</span><span class="p">(</span><span class="n">value2</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="o">-</span><span class="mi">1500</span> <span class="o">&lt;=</span> <span class="n">value2</span> <span class="o">&lt;=</span> <span class="mi">1500</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Value out of range.&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">value</span> <span class="o">*</span> <span class="n">value2</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c1"># Make sure, that one value is positive and one value negative or zero.</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid voltage limit.&quot;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">value2</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SVLM </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">__limit_numeric</span><span class="p">(</span><span class="n">value2</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">test_error</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SVLM </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">__limit_numeric</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">test_error</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">DeviceError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">code</span> <span class="o">==</span> <span class="n">ErrorCode</span><span class="o">.</span><span class="n">LIMIT_OUT_OF_RANGE</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid voltage limit.&quot;</span><span class="p">)</span> <span class="kn">from</span> <span class="kc">None</span>
            <span class="k">raise</span></div>

<div class="viewcode-block" id="Fluke_5440B.get_current_limit"><a class="viewcode-back" href="../../modules.html#fluke5440b_async.Fluke_5440B.get_current_limit">[docs]</a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">get_current_limit</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Decimal</span> <span class="o">|</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">Decimal</span><span class="p">,</span> <span class="n">Decimal</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the current limit set on the instrument. It will raise an error, when in voltage boost mode.</span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        tuple of Decimal</span>
<span class="sd">            The positive and negative limit</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        DeviceError</span>
<span class="sd">            Raised if there was an error processing the command.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># TODO: Needs testing for error when in voltage boost mode</span>
        <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;GCLM&quot;</span><span class="p">,</span> <span class="n">test_error</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">Decimal</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">Decimal</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">Decimal</span><span class="p">(</span><span class="n">result</span><span class="p">)</span></div>

<div class="viewcode-block" id="Fluke_5440B.set_current_limit"><a class="viewcode-back" href="../../modules.html#fluke5440b_async.Fluke_5440B.set_current_limit">[docs]</a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">set_current_limit</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">float</span> <span class="o">|</span> <span class="n">Decimal</span><span class="p">,</span> <span class="n">value2</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">float</span> <span class="o">|</span> <span class="n">Decimal</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the positive and negative current limit.</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        value: int or float or Decimal</span>
<span class="sd">            Either a positive or negative number to set the positive or negative limit.</span>
<span class="sd">        value2: int or float or Decimal, optional</span>
<span class="sd">            Either a positive or negative number to set the positive or negative limit. If omitted, only one limit will</span>
<span class="sd">            be set.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        DeviceError</span>
<span class="sd">            Raised if there was an error processing the command.</span>
<span class="sd">        ValueError</span>
<span class="sd">            Raised if the limits are out of bounds.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">Decimal</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
        <span class="k">if</span> <span class="o">-</span><span class="mi">20</span> <span class="o">&gt;</span> <span class="n">value</span> <span class="o">&gt;</span> <span class="mi">20</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Value out of range.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">value2</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">value2</span> <span class="o">=</span> <span class="n">Decimal</span><span class="p">(</span><span class="n">value2</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="o">-</span><span class="mi">20</span> <span class="o">&lt;=</span> <span class="n">value2</span> <span class="o">&lt;=</span> <span class="mi">20</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Value out of range.&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">value</span> <span class="o">*</span> <span class="n">value2</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid current limit.&quot;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">value2</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SCLM </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">__limit_numeric</span><span class="p">(</span><span class="n">value2</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">test_error</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SCLM </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">__limit_numeric</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">test_error</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">DeviceError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">code</span> <span class="o">==</span> <span class="n">ErrorCode</span><span class="o">.</span><span class="n">LIMIT_OUT_OF_RANGE</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid current limit.&quot;</span><span class="p">)</span> <span class="kn">from</span> <span class="kc">None</span>
            <span class="k">raise</span></div>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">_get_software_version</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Query the version number of the device software. It will return a string formatted as dd.dd.</span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        str</span>
<span class="sd">            The software version number of the instrument.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        DeviceError</span>
<span class="sd">            Raised if there was an error processing the command.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;GVRS&quot;</span><span class="p">,</span> <span class="n">test_error</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>

<div class="viewcode-block" id="Fluke_5440B.get_status"><a class="viewcode-back" href="../../modules.html#fluke5440b_async.Fluke_5440B.get_status">[docs]</a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">get_status</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">StatusFlags</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the status of the instrument. The status flags contain the mode the instrument is running in, like boost</span>
<span class="sd">        mode, or the state of the external sense connection, etc.</span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        StatusFlags</span>
<span class="sd">            The status flags of the different settings</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        DeviceError</span>
<span class="sd">            Raised if there was an error processing the command.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;GSTS&quot;</span><span class="p">,</span> <span class="n">test_error</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
            <span class="n">status</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid reply received. Expected an integer, but received: </span><span class="si">{</span><span class="n">result</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="kn">from</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="n">StatusFlags</span><span class="p">(</span><span class="n">status</span><span class="p">)</span></div>

<div class="viewcode-block" id="Fluke_5440B.get_error"><a class="viewcode-back" href="../../modules.html#fluke5440b_async.Fluke_5440B.get_error">[docs]</a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">get_error</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the last error thrown by the instrument if any. It is recommended to check for errors after using the</span>
<span class="sd">        :func:`write` function, if the `test_error` parameter is not set.</span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        int</span>
<span class="sd">            The last error thrown. It might be an ErrorCode or a SelfTestErrorCode. This is ambiguous and depends on the</span>
<span class="sd">            last command.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Do not test for errors, because this is an infinite loop.</span>
        <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;GERR&quot;</span><span class="p">,</span> <span class="n">test_error</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
            <span class="n">error_code</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid reply received. Expected an integer, but received: </span><span class="si">{</span><span class="n">result</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="kn">from</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="n">error_code</span></div>

<div class="viewcode-block" id="Fluke_5440B.get_state"><a class="viewcode-back" href="../../modules.html#fluke5440b_async.Fluke_5440B.get_state">[docs]</a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">get_state</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DeviceState</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        While the instrument is running long jobs, it signals its current state. Use this to poll the state.</span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        DeviceState</span>
<span class="sd">            The current device state.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        DeviceError</span>
<span class="sd">            Raised if there was an error processing the command.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;GDNG&quot;</span><span class="p">,</span> <span class="n">test_error</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
            <span class="n">dev_state</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid reply received. Expected an integer, but received: </span><span class="si">{</span><span class="n">result</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="kn">from</span> <span class="kc">None</span>

        <span class="k">return</span> <span class="n">DeviceState</span><span class="p">(</span><span class="n">dev_state</span><span class="p">)</span></div>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">__wait_for_rqs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">raise_error</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SerialPollFlags</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Wait until the device requests service (RQS)&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">__conn</span><span class="o">.</span><span class="n">wait</span><span class="p">((</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">11</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">14</span><span class="p">))</span>  <span class="c1"># Wait for RQS or TIMO</span>
        <span class="k">except</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">TimeoutError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="s2">&quot;Timeout during wait. Is the IbaAUTOPOLL(0x7) bit set for the board? Or the timeout set too low?&quot;</span>
            <span class="p">)</span>

        <span class="n">spoll</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">serial_poll</span><span class="p">()</span>  <span class="c1"># Clear the SRQ bit</span>
        <span class="k">if</span> <span class="n">spoll</span> <span class="o">&amp;</span> <span class="n">SerialPollFlags</span><span class="o">.</span><span class="n">ERROR_CONDITION</span> <span class="ow">and</span> <span class="n">raise_error</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                <span class="s2">&quot;Received error while waiting for device to request service. Serial poll register: </span><span class="si">%s</span><span class="s2">.&quot;</span><span class="p">,</span> <span class="n">spoll</span>
            <span class="p">)</span>
            <span class="c1"># If there was an error during waiting, raise it.</span>
            <span class="c1"># I have seen GPIB_HANDSHAKE_ERRORs with a prologix adapter, which does a lot of polling during wait.</span>
            <span class="c1"># Ignore that error for now.</span>
            <span class="n">err</span> <span class="o">=</span> <span class="n">ErrorCode</span><span class="p">(</span><span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_error</span><span class="p">())</span>
            <span class="k">if</span> <span class="n">err</span> <span class="ow">is</span> <span class="n">ErrorCode</span><span class="o">.</span><span class="n">GPIB_HANDSHAKE_ERROR</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                    <span class="s2">&quot;Got error during waiting: </span><span class="si">%s</span><span class="s2">. &quot;</span>
                    <span class="s2">&quot;If you are using a Prologix adapter, this can be safely ignored at this point.&quot;</span><span class="p">,</span>
                    <span class="n">err</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">DeviceError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Device error, code: </span><span class="si">{</span><span class="n">err</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">spoll</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">__wait_for_idle</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Make sure, that SrqMask.DOING_STATE_CHANGE is set.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">state</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_state</span><span class="p">()</span>
        <span class="k">while</span> <span class="n">state</span> <span class="o">!=</span> <span class="n">DeviceState</span><span class="o">.</span><span class="n">IDLE</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Calibrator busy: </span><span class="si">%s</span><span class="s2">.&quot;</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span>
            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">__wait_for_rqs</span><span class="p">()</span>
            <span class="n">state</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_state</span><span class="p">()</span>

<div class="viewcode-block" id="Fluke_5440B.selftest_digital"><a class="viewcode-back" href="../../modules.html#fluke5440b_async.Fluke_5440B.selftest_digital">[docs]</a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">selftest_digital</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Test the main CPU, the front panel CPU and the guard CPU. It will take about 5 seconds during which the</span>
<span class="sd">        instrument hardware is blocked. See page 3-19 of the operator manual for details.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        DeviceError</span>
<span class="sd">            Raised if there was an error processing the command.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">__lock</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="k">async</span> <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">__lock</span><span class="p">:</span>
            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_srq_mask</span><span class="p">(</span><span class="n">SrqMask</span><span class="o">.</span><span class="n">DOING_STATE_CHANGE</span><span class="p">)</span>  <span class="c1"># Enable SRQs to wait for each test step</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Running digital self-test. This takes about 5 seconds.&quot;</span><span class="p">)</span>
                <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">__wait_for_idle</span><span class="p">()</span>

                <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;TSTD&quot;</span><span class="p">,</span> <span class="n">test_error</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">while</span> <span class="s2">&quot;testing&quot;</span><span class="p">:</span>
                    <span class="n">status</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">__wait_for_rqs</span><span class="p">(</span><span class="n">raise_error</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">status</span> <span class="o">&amp;</span> <span class="n">SerialPollFlags</span><span class="o">.</span><span class="n">ERROR_CONDITION</span><span class="p">:</span>
                        <span class="n">error_code</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_error</span><span class="p">()</span>
                        <span class="k">raise</span> <span class="n">SelftestError</span><span class="p">(</span><span class="s2">&quot;Digital&quot;</span><span class="p">,</span> <span class="n">SelfTestErrorCode</span><span class="p">(</span><span class="n">error_code</span><span class="p">))</span>
                    <span class="k">if</span> <span class="n">status</span> <span class="o">&amp;</span> <span class="n">SerialPollFlags</span><span class="o">.</span><span class="n">DOING_STATE_CHANGE</span><span class="p">:</span>
                        <span class="n">state</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_state</span><span class="p">()</span>
                        <span class="k">if</span> <span class="n">state</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span>
                            <span class="n">DeviceState</span><span class="o">.</span><span class="n">IDLE</span><span class="p">,</span>
                            <span class="n">DeviceState</span><span class="o">.</span><span class="n">SELF_TEST_MAIN_CPU</span><span class="p">,</span>
                            <span class="n">DeviceState</span><span class="o">.</span><span class="n">SELF_TEST_FRONTPANEL_CPU</span><span class="p">,</span>
                            <span class="n">DeviceState</span><span class="o">.</span><span class="n">SELF_TEST_GUARD_CPU</span><span class="p">,</span>
                        <span class="p">):</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">__logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Digital self-test failed. Invalid state: </span><span class="si">%s</span><span class="s2">.&quot;</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span>

                        <span class="k">if</span> <span class="n">state</span> <span class="o">==</span> <span class="n">DeviceState</span><span class="o">.</span><span class="n">IDLE</span><span class="p">:</span>
                            <span class="k">break</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">__logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Self-test status: </span><span class="si">%s</span><span class="s2">.&quot;</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Digital self-test passed.&quot;</span><span class="p">)</span>
            <span class="k">finally</span><span class="p">:</span>
                <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_srq_mask</span><span class="p">(</span><span class="n">SrqMask</span><span class="o">.</span><span class="n">NONE</span><span class="p">)</span>  <span class="c1"># Disable SRQs</span></div>

<div class="viewcode-block" id="Fluke_5440B.selftest_analog"><a class="viewcode-back" href="../../modules.html#fluke5440b_async.Fluke_5440B.selftest_analog">[docs]</a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">selftest_analog</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Test the ADC, the low voltage part and the oven. It will take about 4 minutes during which the instrument</span>
<span class="sd">        hardware is blocked. See page 3-19 of the operator manual for details.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        DeviceError</span>
<span class="sd">            Raised if there was an error processing the command.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">__lock</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="k">async</span> <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">__lock</span><span class="p">:</span>
            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_srq_mask</span><span class="p">(</span><span class="n">SrqMask</span><span class="o">.</span><span class="n">DOING_STATE_CHANGE</span><span class="p">)</span>  <span class="c1"># Enable SRQs to wait for each test step</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Running analog self-test. This takes about 4 minutes.&quot;</span><span class="p">)</span>
                <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">__wait_for_idle</span><span class="p">()</span>

                <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;TSTA&quot;</span><span class="p">,</span> <span class="n">test_error</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">while</span> <span class="s2">&quot;testing&quot;</span><span class="p">:</span>
                    <span class="n">status</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">__wait_for_rqs</span><span class="p">(</span><span class="n">raise_error</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">status</span> <span class="o">&amp;</span> <span class="n">SerialPollFlags</span><span class="o">.</span><span class="n">ERROR_CONDITION</span><span class="p">:</span>
                        <span class="n">error_code</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_error</span><span class="p">()</span>
                        <span class="k">raise</span> <span class="n">SelftestError</span><span class="p">(</span><span class="s2">&quot;Analog&quot;</span><span class="p">,</span> <span class="n">SelfTestErrorCode</span><span class="p">(</span><span class="n">error_code</span><span class="p">))</span>
                    <span class="k">if</span> <span class="n">status</span> <span class="o">&amp;</span> <span class="n">SerialPollFlags</span><span class="o">.</span><span class="n">DOING_STATE_CHANGE</span><span class="p">:</span>
                        <span class="n">state</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_state</span><span class="p">()</span>
                        <span class="k">if</span> <span class="n">state</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span>
                            <span class="n">DeviceState</span><span class="o">.</span><span class="n">IDLE</span><span class="p">,</span>
                            <span class="n">DeviceState</span><span class="o">.</span><span class="n">CALIBRATING_ADC</span><span class="p">,</span>
                            <span class="n">DeviceState</span><span class="o">.</span><span class="n">SELF_TEST_LOW_VOLTAGE</span><span class="p">,</span>
                            <span class="n">DeviceState</span><span class="o">.</span><span class="n">SELF_TEST_OVEN</span><span class="p">,</span>
                        <span class="p">):</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">__logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Analog self-test failed. Invalid state: </span><span class="si">%s</span><span class="s2">.&quot;</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span>

                        <span class="k">if</span> <span class="n">state</span> <span class="o">==</span> <span class="n">DeviceState</span><span class="o">.</span><span class="n">IDLE</span><span class="p">:</span>
                            <span class="k">break</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">__logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Self-test status: </span><span class="si">%s</span><span class="s2">.&quot;</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Analog self-test passed.&quot;</span><span class="p">)</span>
            <span class="k">finally</span><span class="p">:</span>
                <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_srq_mask</span><span class="p">(</span><span class="n">SrqMask</span><span class="o">.</span><span class="n">NONE</span><span class="p">)</span>  <span class="c1"># Disable SRQs</span></div>

<div class="viewcode-block" id="Fluke_5440B.selftest_hv"><a class="viewcode-back" href="../../modules.html#fluke5440b_async.Fluke_5440B.selftest_hv">[docs]</a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">selftest_hv</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Test the ADC and the high voltage part. It will take about 1 minute during which the instrument hardware is</span>
<span class="sd">        blocked. See page 3-20 of the operator manual for details.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        DeviceError</span>
<span class="sd">            Raised if there was an error processing the command.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">__lock</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="k">async</span> <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">__lock</span><span class="p">:</span>
            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_srq_mask</span><span class="p">(</span><span class="n">SrqMask</span><span class="o">.</span><span class="n">DOING_STATE_CHANGE</span><span class="p">)</span>  <span class="c1"># Enable SRQs to wait for each test step</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Running high voltage self-test. This takes about 1 minute.&quot;</span><span class="p">)</span>
                <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">__wait_for_idle</span><span class="p">()</span>

                <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;TSTH&quot;</span><span class="p">,</span> <span class="n">test_error</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">while</span> <span class="s2">&quot;testing&quot;</span><span class="p">:</span>
                    <span class="n">status</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">__wait_for_rqs</span><span class="p">(</span><span class="n">raise_error</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">status</span> <span class="o">&amp;</span> <span class="n">SerialPollFlags</span><span class="o">.</span><span class="n">ERROR_CONDITION</span><span class="p">:</span>
                        <span class="n">error_code</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_error</span><span class="p">()</span>
                        <span class="k">raise</span> <span class="n">SelftestError</span><span class="p">(</span><span class="s2">&quot;High voltage&quot;</span><span class="p">,</span> <span class="n">SelfTestErrorCode</span><span class="p">(</span><span class="n">error_code</span><span class="p">))</span>
                    <span class="k">if</span> <span class="n">status</span> <span class="o">&amp;</span> <span class="n">SerialPollFlags</span><span class="o">.</span><span class="n">DOING_STATE_CHANGE</span><span class="p">:</span>
                        <span class="n">state</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_state</span><span class="p">()</span>
                        <span class="k">if</span> <span class="n">state</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span>
                            <span class="n">DeviceState</span><span class="o">.</span><span class="n">IDLE</span><span class="p">,</span>
                            <span class="n">DeviceState</span><span class="o">.</span><span class="n">CALIBRATING_ADC</span><span class="p">,</span>
                            <span class="n">DeviceState</span><span class="o">.</span><span class="n">SELF_TEST_HIGH_VOLTAGE</span><span class="p">,</span>
                        <span class="p">):</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">__logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;High voltage self-test failed. Invalid state: </span><span class="si">%s</span><span class="s2">.&quot;</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span>

                        <span class="k">if</span> <span class="n">state</span> <span class="o">==</span> <span class="n">DeviceState</span><span class="o">.</span><span class="n">IDLE</span><span class="p">:</span>
                            <span class="k">break</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">__logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Self-test status: </span><span class="si">%s</span><span class="s2">.&quot;</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;High voltage self-test passed.&quot;</span><span class="p">)</span>
            <span class="k">finally</span><span class="p">:</span>
                <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_srq_mask</span><span class="p">(</span><span class="n">SrqMask</span><span class="o">.</span><span class="n">NONE</span><span class="p">)</span>  <span class="c1"># Disable SRQs</span></div>

<div class="viewcode-block" id="Fluke_5440B.selftest_all"><a class="viewcode-back" href="../../modules.html#fluke5440b_async.Fluke_5440B.selftest_all">[docs]</a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">selftest_all</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Run all three self-tests. This function is a combination of :func:`selftest_digital`, :func:`selftest_analog`</span>
<span class="sd">        and :func:`selftest_hv`.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        DeviceError</span>
<span class="sd">            Raised if there was an error processing the command.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">selftest_digital</span><span class="p">()</span>
        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">selftest_analog</span><span class="p">()</span>
        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">selftest_hv</span><span class="p">()</span></div>

<div class="viewcode-block" id="Fluke_5440B.acal"><a class="viewcode-back" href="../../modules.html#fluke5440b_async.Fluke_5440B.acal">[docs]</a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">acal</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Run the internal calibration routine. It will take about 6.5 minutes during which the instrument hardware is</span>
<span class="sd">        blocked. See page 3-2 of the operator manual for details.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">__lock</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="k">async</span> <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">__lock</span><span class="p">:</span>
            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_srq_mask</span><span class="p">(</span><span class="n">SrqMask</span><span class="o">.</span><span class="n">DOING_STATE_CHANGE</span><span class="p">)</span>  <span class="c1"># Enable SRQs to wait for each calibration step</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Running internal calibration. This will take about 6.5 minutes.&quot;</span><span class="p">)</span>
                <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">__wait_for_idle</span><span class="p">()</span>

                <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;CALI&quot;</span><span class="p">,</span> <span class="n">test_error</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">while</span> <span class="s2">&quot;calibrating&quot;</span><span class="p">:</span>
                    <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">__wait_for_rqs</span><span class="p">()</span>
                    <span class="n">state</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_state</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">state</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span>
                        <span class="n">DeviceState</span><span class="o">.</span><span class="n">IDLE</span><span class="p">,</span>
                        <span class="n">DeviceState</span><span class="o">.</span><span class="n">CALIBRATING_ADC</span><span class="p">,</span>
                        <span class="n">DeviceState</span><span class="o">.</span><span class="n">ZEROING_10V_POS</span><span class="p">,</span>
                        <span class="n">DeviceState</span><span class="o">.</span><span class="n">CAL_N1_N2_RATIO</span><span class="p">,</span>
                        <span class="n">DeviceState</span><span class="o">.</span><span class="n">ZEROING_10V_NEG</span><span class="p">,</span>
                        <span class="n">DeviceState</span><span class="o">.</span><span class="n">ZEROING_20V_POS</span><span class="p">,</span>
                        <span class="n">DeviceState</span><span class="o">.</span><span class="n">ZEROING_20V_NEG</span><span class="p">,</span>
                        <span class="n">DeviceState</span><span class="o">.</span><span class="n">ZEROING_250V_POS</span><span class="p">,</span>
                        <span class="n">DeviceState</span><span class="o">.</span><span class="n">ZEROING_250V_NEG</span><span class="p">,</span>
                        <span class="n">DeviceState</span><span class="o">.</span><span class="n">ZEROING_1000V_POS</span><span class="p">,</span>
                        <span class="n">DeviceState</span><span class="o">.</span><span class="n">ZEROING_1000V_NEG</span><span class="p">,</span>
                        <span class="n">DeviceState</span><span class="o">.</span><span class="n">CALIBRATING_GAIN_10V_POS</span><span class="p">,</span>
                        <span class="n">DeviceState</span><span class="o">.</span><span class="n">CALIBRATING_GAIN_20V_POS</span><span class="p">,</span>
                        <span class="n">DeviceState</span><span class="o">.</span><span class="n">CALIBRATING_GAIN_HV_POS</span><span class="p">,</span>
                        <span class="n">DeviceState</span><span class="o">.</span><span class="n">CALIBRATING_GAIN_HV_NEG</span><span class="p">,</span>
                        <span class="n">DeviceState</span><span class="o">.</span><span class="n">CALIBRATING_GAIN_20V_NEG</span><span class="p">,</span>
                        <span class="n">DeviceState</span><span class="o">.</span><span class="n">CALIBRATING_GAIN_10V_NEG</span><span class="p">,</span>
                        <span class="n">DeviceState</span><span class="o">.</span><span class="n">WRITING_TO_NVRAM</span><span class="p">,</span>
                    <span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">__logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Internal calibration failed. Invalid state: </span><span class="si">%s</span><span class="s2">.&quot;</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span>

                    <span class="k">if</span> <span class="n">state</span> <span class="o">==</span> <span class="n">DeviceState</span><span class="o">.</span><span class="n">IDLE</span><span class="p">:</span>
                        <span class="k">break</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Calibration status: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">state</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Internal calibration done.&quot;</span><span class="p">)</span>
            <span class="k">finally</span><span class="p">:</span>
                <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_srq_mask</span><span class="p">(</span><span class="n">SrqMask</span><span class="o">.</span><span class="n">NONE</span><span class="p">)</span>  <span class="c1"># Disable SRQs</span></div>

<div class="viewcode-block" id="Fluke_5440B.get_calibration_constants"><a class="viewcode-back" href="../../modules.html#fluke5440b_async.Fluke_5440B.get_calibration_constants">[docs]</a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">get_calibration_constants</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CalibrationConstants</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Query the calibration constants and gain shifts with respect to the previous internal calibration. See page 3-18</span>
<span class="sd">        of the operator manual for details.</span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        CalibrationConstants:</span>
<span class="sd">            A dataclass containing the constants as Decimals</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">__lock</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="k">async</span> <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">__lock</span><span class="p">:</span>
            <span class="c1"># We need to split the query in two parts, because the input buffer of the 5440B is only 127 byte</span>
            <span class="n">values</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s2">&quot;GCAL &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">)]),</span> <span class="n">test_error</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
            <span class="n">values</span> <span class="o">+=</span> <span class="n">cast</span><span class="p">(</span>
                <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s2">&quot;GCAL &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">)]),</span> <span class="n">test_error</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="n">CalibrationConstants</span><span class="p">(</span>
                <span class="n">gain_02V</span><span class="o">=</span><span class="n">Decimal</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">5</span><span class="p">]),</span>
                <span class="n">gain_2V</span><span class="o">=</span><span class="n">Decimal</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">4</span><span class="p">]),</span>
                <span class="n">gain_10V</span><span class="o">=</span><span class="n">Decimal</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                <span class="n">gain_20V</span><span class="o">=</span><span class="n">Decimal</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                <span class="n">gain_250V</span><span class="o">=</span><span class="n">Decimal</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span>
                <span class="n">gain_1000V</span><span class="o">=</span><span class="n">Decimal</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">3</span><span class="p">]),</span>
                <span class="n">offset_10V_pos</span><span class="o">=</span><span class="n">Decimal</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">6</span><span class="p">]),</span>
                <span class="n">offset_20V_pos</span><span class="o">=</span><span class="n">Decimal</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">7</span><span class="p">]),</span>
                <span class="n">offset_250V_pos</span><span class="o">=</span><span class="n">Decimal</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">8</span><span class="p">]),</span>
                <span class="n">offset_1000V_pos</span><span class="o">=</span><span class="n">Decimal</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">9</span><span class="p">]),</span>
                <span class="n">offset_10V_neg</span><span class="o">=</span><span class="n">Decimal</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">10</span><span class="p">]),</span>
                <span class="n">offset_20V_neg</span><span class="o">=</span><span class="n">Decimal</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">11</span><span class="p">]),</span>
                <span class="n">offset_250V_neg</span><span class="o">=</span><span class="n">Decimal</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">12</span><span class="p">]),</span>
                <span class="n">offset_1000V_neg</span><span class="o">=</span><span class="n">Decimal</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">13</span><span class="p">]),</span>
                <span class="n">gain_shift_10V</span><span class="o">=</span><span class="n">Decimal</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">14</span><span class="p">]),</span>
                <span class="n">gain_shift_20V</span><span class="o">=</span><span class="n">Decimal</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">15</span><span class="p">]),</span>
                <span class="n">gain_shift_250V</span><span class="o">=</span><span class="n">Decimal</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">16</span><span class="p">]),</span>
                <span class="n">gain_shift_1000V</span><span class="o">=</span><span class="n">Decimal</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">17</span><span class="p">]),</span>
                <span class="n">resolution_ratio</span><span class="o">=</span><span class="n">Decimal</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">18</span><span class="p">]),</span>
                <span class="n">adc_gain</span><span class="o">=</span><span class="n">Decimal</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">19</span><span class="p">]),</span>
            <span class="p">)</span></div>

<div class="viewcode-block" id="Fluke_5440B.get_rs232_baud_rate"><a class="viewcode-back" href="../../modules.html#fluke5440b_async.Fluke_5440B.get_rs232_baud_rate">[docs]</a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">get_rs232_baud_rate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the RS-232 the baud rate in bit/s.</span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        float</span>
<span class="sd">            The baud rate in bit/s</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        DeviceError</span>
<span class="sd">            If test_error is set to True and there was an error processing the command.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;GBDR&quot;</span><span class="p">,</span> <span class="n">test_error</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
            <span class="n">baud_rate</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid reply received. Expected an integer, but received: </span><span class="si">{</span><span class="n">result</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="kn">from</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">BAUD_RATES_AVAILABLE</span><span class="p">[</span><span class="n">baud_rate</span><span class="p">]</span></div>

<div class="viewcode-block" id="Fluke_5440B.set_rs232_baud_rate"><a class="viewcode-back" href="../../modules.html#fluke5440b_async.Fluke_5440B.set_rs232_baud_rate">[docs]</a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">set_rs232_baud_rate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the baud rate of the RS-232 interface.</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        value: {50, 75, 110, 134.5, 150, 200, 300, 600, 1200, 1800, 2400, 4800, 9600}</span>
<span class="sd">            The baud rate.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        DeviceError</span>
<span class="sd">            If test_error is set to True and there was an error processing the command.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">BAUD_RATES_AVAILABLE</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid baud rate. It must be one of: </span><span class="si">{</span><span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span><span class="w"> </span><span class="n">BAUD_RATES_AVAILABLE</span><span class="p">))</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">__lock</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="k">async</span> <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">__lock</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Setting baud rate to </span><span class="si">%d</span><span class="s2"> and writing to NVRAM. This takes about 1.5 minutes.&quot;</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SBDR </span><span class="si">{</span><span class="n">BAUD_RATES_AVAILABLE</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="si">:</span><span class="s2">d</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">test_error</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_srq_mask</span><span class="p">(</span><span class="n">SrqMask</span><span class="o">.</span><span class="n">DOING_STATE_CHANGE</span><span class="p">)</span>  <span class="c1"># Enable SRQs to wait until written to NVRAM</span>
                <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
                <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">__wait_for_idle</span><span class="p">()</span>
            <span class="k">finally</span><span class="p">:</span>
                <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">set_srq_mask</span><span class="p">(</span><span class="n">SrqMask</span><span class="o">.</span><span class="n">NONE</span><span class="p">)</span>  <span class="c1"># Disable SRQs</span></div>

<div class="viewcode-block" id="Fluke_5440B.set_enable_rs232"><a class="viewcode-back" href="../../modules.html#fluke5440b_async.Fluke_5440B.set_enable_rs232">[docs]</a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">set_enable_rs232</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">enabled</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Enable the RS-232 printer port.</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        enabled: bool</span>
<span class="sd">            True to enable the RS-232 port.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        DeviceError</span>
<span class="sd">            If test_error is set to True and there was an error processing the command.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;MONY&quot;</span> <span class="k">if</span> <span class="n">enabled</span> <span class="k">else</span> <span class="s2">&quot;MONN&quot;</span><span class="p">,</span> <span class="n">test_error</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="Fluke_5440B.serial_poll"><a class="viewcode-back" href="../../modules.html#fluke5440b_async.Fluke_5440B.serial_poll">[docs]</a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">serial_poll</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SerialPollFlags</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Poll the serial output buffer of the device. This can be used to query for the SRQ bit when device requests</span>
<span class="sd">        service, has encountered an error or is busy.</span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        SerialPollFlags</span>
<span class="sd">            The content of the serial output buffer</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">SerialPollFlags</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">__conn</span><span class="o">.</span><span class="n">serial_poll</span><span class="p">()))</span></div>

<div class="viewcode-block" id="Fluke_5440B.get_srq_mask"><a class="viewcode-back" href="../../modules.html#fluke5440b_async.Fluke_5440B.get_srq_mask">[docs]</a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">get_srq_mask</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SrqMask</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the SRQ mask. This mask is used to determine, when the device will signal the SRQ line.</span>
<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        SrqMask</span>
<span class="sd">            The bitmask to determine the bits to signal.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        DeviceError</span>
<span class="sd">            If test_error is set to True and there was an error processing the command.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;GSRQ&quot;</span><span class="p">,</span> <span class="n">test_error</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
            <span class="n">mask</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid reply received. Expected an integer, but received: </span><span class="si">{</span><span class="n">result</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> <span class="kn">from</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">SrqMask</span><span class="p">(</span><span class="n">mask</span><span class="p">)</span></div>

<div class="viewcode-block" id="Fluke_5440B.set_srq_mask"><a class="viewcode-back" href="../../modules.html#fluke5440b_async.Fluke_5440B.set_srq_mask">[docs]</a>    <span class="k">async</span> <span class="k">def</span> <span class="nf">set_srq_mask</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">SrqMask</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the service request mask register. Each bit set, will signal the SRQ line, when a service request of the</span>
<span class="sd">        device is triggered.</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        value: SrqMask</span>
<span class="sd">            The bitmask to set.</span>

<span class="sd">        Raises</span>
<span class="sd">        ------</span>
<span class="sd">        DeviceError</span>
<span class="sd">            If test_error is set to True and there was an error processing the command.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">SrqMask</span><span class="p">)</span>
        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;SSRQ </span><span class="si">{</span><span class="n">value</span><span class="o">.</span><span class="n">value</span><span class="si">:</span><span class="s2">d</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">test_error</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div></div>
</pre></div>

            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">fluke5440b_async v1.0.1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">fluke5440b_async.fluke_5440b</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2023, Patrick Baus.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 6.2.0.
    </div>
  </body>
</html>